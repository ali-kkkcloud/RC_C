<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Portal - Settings</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard">
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1 class="header-title">EMPLOYEE PORTAL</h1>
        </div>
        <div class="header-right">
            <button class="notification-btn" onclick="toggleNotifications()">
                <i class="fas fa-bell"></i>
                <span class="notification-badge" id="notificationBadge"></span>
            </button>
            <div class="user-menu" onclick="toggleUserMenu()">
                <div class="user-avatar">AD</div>
                <span class="user-name">Admin User</span>
                <i class="fas fa-chevron-down"></i>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="nav-menu">
                <div class="nav-item">
                    <a href="admin-dashboard.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="showEmployeeManagement()">
                        <i class="fas fa-users"></i>
                        <span>Employees</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="attendance.html" class="nav-link">
                        <i class="fas fa-clock"></i>
                        <span>Attendance</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="showTaskManagement()">
                        <i class="fas fa-tasks"></i>
                        <span>Tasks</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="training.html" class="nav-link">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Training</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" onclick="showReports()">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="settings.html" class="nav-link active">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">System Settings</h1>
                <p class="page-subtitle">Configure system preferences and manage application settings</p>
            </div>

            <!-- Settings Navigation -->
            <div class="settings-nav">
                <button class="settings-tab active" onclick="showSettingsTab('general')">
                    <i class="fas fa-cog"></i>
                    General
                </button>
                <button class="settings-tab" onclick="showSettingsTab('company')">
                    <i class="fas fa-building"></i>
                    Company
                </button>
                <button class="settings-tab" onclick="showSettingsTab('attendance')">
                    <i class="fas fa-clock"></i>
                    Attendance
                </button>
                <button class="settings-tab" onclick="showSettingsTab('notifications')">
                    <i class="fas fa-bell"></i>
                    Notifications
                </button>
                <button class="settings-tab" onclick="showSettingsTab('security')">
                    <i class="fas fa-shield-alt"></i>
                    Security
                </button>
                <button class="settings-tab" onclick="showSettingsTab('backup')">
                    <i class="fas fa-database"></i>
                    Backup
                </button>
            </div>

            <!-- General Settings -->
            <div id="generalSettings" class="settings-panel active">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">General Preferences</h3>
                        <p class="card-description">Configure basic system preferences and appearance</p>
                    </div>
                    <form id="generalSettingsForm">
                        <div class="form-group">
                            <label for="systemLanguage">System Language</label>
                            <select id="systemLanguage" name="language" class="form-control">
                                <option value="en" selected>English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="hi">Hindi</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="timezone">Timezone</label>
                            <select id="timezone" name="timezone" class="form-control">
                                <option value="UTC-12">(UTC-12:00) International Date Line West</option>
                                <option value="UTC-8">(UTC-08:00) Pacific Time (US & Canada)</option>
                                <option value="UTC-5">(UTC-05:00) Eastern Time (US & Canada)</option>
                                <option value="UTC+0">(UTC+00:00) London, Dublin</option>
                                <option value="UTC+5:30" selected>(UTC+05:30) Mumbai, Delhi, Bangalore</option>
                                <option value="UTC+8">(UTC+08:00) Beijing, Singapore</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="dateFormat">Date Format</label>
                            <select id="dateFormat" name="date_format" class="form-control">
                                <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                <option value="DD-MM-YYYY">DD-MM-YYYY</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="timeFormat">Time Format</label>
                            <select id="timeFormat" name="time_format" class="form-control">
                                <option value="12" selected>12 Hour (AM/PM)</option>
                                <option value="24">24 Hour</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="theme">Theme</label>
                            <select id="theme" name="theme" class="form-control">
                                <option value="light" selected>Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto (System)</option>
                            </select>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save General Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Company Settings -->
            <div id="companySettings" class="settings-panel">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Company Information</h3>
                        <p class="card-description">Manage company details and branding</p>
                    </div>
                    <form id="companySettingsForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="companyName">Company Name</label>
                                <input type="text" id="companyName" name="company_name" class="form-control" value="Your Company" required>
                            </div>
                            <div class="form-group">
                                <label for="companyWebsite">Website</label>
                                <input type="url" id="companyWebsite" name="website" class="form-control" placeholder="https://www.company.com">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="companyEmail">Company Email</label>
                                <input type="email" id="companyEmail" name="email" class="form-control" placeholder="contact@company.com">
                            </div>
                            <div class="form-group">
                                <label for="companyPhone">Company Phone</label>
                                <input type="tel" id="companyPhone" name="phone" class="form-control" placeholder="+1 (555) 123-4567">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="companyAddress">Address</label>
                            <textarea id="companyAddress" name="address" class="form-control" rows="3" placeholder="Enter company address"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="companyLogo">Company Logo</label>
                            <div class="file-upload-area">
                                <input type="file" id="companyLogo" name="logo" accept="image/*" class="file-input">
                                <div class="file-upload-content">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload logo or drag and drop</p>
                                    <small>PNG, JPG or SVG (max 2MB)</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Company Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Attendance Settings -->
            <div id="attendanceSettings" class="settings-panel">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Attendance Configuration</h3>
                        <p class="card-description">Configure work hours, break times, and attendance policies</p>
                    </div>
                    <form id="attendanceSettingsForm">
                        <div class="form-section">
                            <h4>Work Hours</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="workStartTime">Start Time</label>
                                    <input type="time" id="workStartTime" name="start_time" class="form-control" value="09:00">
                                </div>
                                <div class="form-group">
                                    <label for="workEndTime">End Time</label>
                                    <input type="time" id="workEndTime" name="end_time" class="form-control" value="17:00">
                                </div>
                                <div class="form-group">
                                    <label for="breakDuration">Break Duration (minutes)</label>
                                    <input type="number" id="breakDuration" name="break_duration" class="form-control" value="60" min="0" max="180">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Attendance Policies</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="lateThreshold">Late Arrival Threshold (minutes)</label>
                                    <input type="number" id="lateThreshold" name="late_threshold" class="form-control" value="15" min="0" max="60">
                                    <small class="text-muted">Employees arriving after this time will be marked as late</small>
                                </div>
                                <div class="form-group">
                                    <label for="earlyCheckout">Early Checkout Threshold (minutes)</label>
                                    <input type="number" id="earlyCheckout" name="early_checkout" class="form-control" value="30" min="0" max="120">
                                    <small class="text-muted">Leaving before this time will be flagged</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Work Days</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="monday" checked>
                                    <span class="checkmark"></span>
                                    Monday
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="tuesday" checked>
                                    <span class="checkmark"></span>
                                    Tuesday
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="wednesday" checked>
                                    <span class="checkmark"></span>
                                    Wednesday
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="thursday" checked>
                                    <span class="checkmark"></span>
                                    Thursday
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="friday" checked>
                                    <span class="checkmark"></span>
                                    Friday
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="saturday">
                                    <span class="checkmark"></span>
                                    Saturday
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="work_days" value="sunday">
                                    <span class="checkmark"></span>
                                    Sunday
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Attendance Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Notification Settings -->
            <div id="notificationSettings" class="settings-panel">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Notification Preferences</h3>
                        <p class="card-description">Configure how and when to receive notifications</p>
                    </div>
                    <form id="notificationSettingsForm">
                        <div class="form-section">
                            <h4>Email Notifications</h4>
                            <div class="toggle-group">
                                <label class="toggle-item">
                                    <input type="checkbox" name="email_enabled" checked>
                                    <span class="toggle-switch"></span>
                                    Enable Email Notifications
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="daily_summary" checked>
                                    <span class="toggle-switch"></span>
                                    Daily Summary Email
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="absence_alerts">
                                    <span class="toggle-switch"></span>
                                    Employee Absence Alerts
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="task_reminders" checked>
                                    <span class="toggle-switch"></span>
                                    Task Due Date Reminders
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>System Notifications</h4>
                            <div class="toggle-group">
                                <label class="toggle-item">
                                    <input type="checkbox" name="push_enabled" checked>
                                    <span class="toggle-switch"></span>
                                    Enable Push Notifications
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="shift_reminders" checked>
                                    <span class="toggle-switch"></span>
                                    Shift Start Reminders
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="break_reminders">
                                    <span class="toggle-switch"></span>
                                    Break Time Reminders
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="system_maintenance">
                                    <span class="toggle-switch"></span>
                                    System Maintenance Alerts
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="notificationEmail">Notification Email</label>
                            <input type="email" id="notificationEmail" name="notification_email" class="form-control" placeholder="admin@company.com">
                            <small class="text-muted">Primary email for receiving system notifications</small>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Notification Settings
                            </button>
                            <button type="button" class="btn btn-outline" onclick="testNotifications()">
                                <i class="fas fa-paper-plane"></i>
                                Send Test Notification
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Security Settings -->
            <div id="securitySettings" class="settings-panel">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Security & Privacy</h3>
                        <p class="card-description">Manage security policies and privacy settings</p>
                    </div>
                    <form id="securitySettingsForm">
                        <div class="form-section">
                            <h4>Password Policy</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="minPasswordLength">Minimum Password Length</label>
                                    <input type="number" id="minPasswordLength" name="min_password_length" class="form-control" value="8" min="6" max="20">
                                </div>
                                <div class="form-group">
                                    <label for="passwordExpiry">Password Expiry (days)</label>
                                    <input type="number" id="passwordExpiry" name="password_expiry" class="form-control" value="90" min="30" max="365">
                                </div>
                            </div>
                            
                            <div class="toggle-group">
                                <label class="toggle-item">
                                    <input type="checkbox" name="require_uppercase" checked>
                                    <span class="toggle-switch"></span>
                                    Require Uppercase Letter
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="require_lowercase" checked>
                                    <span class="toggle-switch"></span>
                                    Require Lowercase Letter
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="require_numbers" checked>
                                    <span class="toggle-switch"></span>
                                    Require Numbers
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="require_symbols">
                                    <span class="toggle-switch"></span>
                                    Require Special Characters
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Session Management</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="sessionTimeout">Session Timeout (minutes)</label>
                                    <input type="number" id="sessionTimeout" name="session_timeout" class="form-control" value="30" min="5" max="480">
                                </div>
                                <div class="form-group">
                                    <label for="maxLoginAttempts">Max Login Attempts</label>
                                    <input type="number" id="maxLoginAttempts" name="max_login_attempts" class="form-control" value="5" min="3" max="10">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Data Privacy</h4>
                            <div class="toggle-group">
                                <label class="toggle-item">
                                    <input type="checkbox" name="data_encryption" checked disabled>
                                    <span class="toggle-switch"></span>
                                    Data Encryption (Always On)
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="audit_logging" checked>
                                    <span class="toggle-switch"></span>
                                    Audit Logging
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="gdpr_compliance" checked>
                                    <span class="toggle-switch"></span>
                                    GDPR Compliance Mode
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" name="ip_restrictions">
                                    <span class="toggle-switch"></span>
                                    IP Address Restrictions
                                </label>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Security Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Backup Settings -->
            <div id="backupSettings" class="settings-panel">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Backup & Recovery</h3>
                        <p class="card-description">Configure automatic backups and data recovery options</p>
                    </div>
                    <form id="backupSettingsForm">
                        <div class="form-section">
                            <h4>Automatic Backup</h4>
                            <div class="toggle-group">
                                <label class="toggle-item">
                                    <input type="checkbox" name="auto_backup" checked>
                                    <span class="toggle-switch"></span>
                                    Enable Automatic Backup
                                </label>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="backupFrequency">Backup Frequency</label>
                                    <select id="backupFrequency" name="backup_frequency" class="form-control">
                                        <option value="daily" selected>Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="backupTime">Backup Time</label>
                                    <input type="time" id="backupTime" name="backup_time" class="form-control" value="02:00">
                                </div>
                                <div class="form-group">
                                    <label for="retentionDays">Retention Period (days)</label>
                                    <input type="number" id="retentionDays" name="retention_days" class="form-control" value="30" min="7" max="365">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Backup Status</h4>
                            <div class="backup-status">
                                <div class="status-item">
                                    <div class="status-label">Last Backup:</div>
                                    <div class="status-value" id="lastBackupTime">2 hours ago</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Backup Size:</div>
                                    <div class="status-value">247 MB</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Next Backup:</div>
                                    <div class="status-value">Tonight at 2:00 AM</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Status:</div>
                                    <div class="status-value">
                                        <span class="badge badge-success">
                                            <i class="fas fa-check-circle"></i>
                                            Healthy
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Backup Settings
                            </button>
                            <button type="button" class="btn btn-success" onclick="performManualBackup()">
                                <i class="fas fa-database"></i>
                                Create Backup Now
                            </button>
                            <button type="button" class="btn btn-outline" onclick="downloadBackup()">
                                <i class="fas fa-download"></i>
                                Download Latest Backup
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- System Information -->
            <div class="card mt-30">
                <div class="card-header">
                    <h3 class="card-title">System Information</h3>
                </div>
                <div class="system-info">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Version:</div>
                            <div class="info-value">1.0.0</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Last Updated:</div>
                            <div class="info-value">June 15, 2024</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Database:</div>
                            <div class="info-value">
                                <span class="badge badge-success">
                                    <i class="fas fa-circle"></i>
                                    Connected
                                </span>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Storage Used:</div>
                            <div class="info-value">
                                <div class="storage-bar">
                                    <div class="storage-fill" style="width: 68%"></div>
                                </div>
                                <span>680 MB / 1 GB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- User Menu Dropdown -->
    <div id="userMenuDropdown" class="dropdown-menu">
        <a href="#" onclick="showProfile()">
            <i class="fas fa-user"></i>
            My Profile
        </a>
        <a href="settings.html">
            <i class="fas fa-cog"></i>
            Settings
        </a>
        <hr>
        <a href="#" class="logout-btn">
            <i class="fas fa-sign-out-alt"></i>
            Logout
        </a>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/admin-functions.js"></script>
    
    <script>
        // Settings page specific functions
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            initializeSettingsPage();
            loadCurrentSettings();
        });

        function initializeSettingsPage() {
            const userData = JSON.parse(localStorage.getItem('currentUser') || '{}');
            
            // Check if user has admin access
            if (userData.role !== 'admin') {
                showNotification('Access denied. Admin privileges required.', 'error');
                setTimeout(() => {
                    window.location.href = 'employee-dashboard.html';
                }, 2000);
                return;
            }
            
            document.querySelector('.user-name').textContent = userData.name || 'Admin';
            document.querySelector('.user-avatar').textContent = StringUtils.getInitials(userData.name || 'Admin');
            
            setupFormHandlers();
            setupFileUpload();
        }

        function setupFormHandlers() {
            // General settings form
            document.getElementById('generalSettingsForm').addEventListener('submit', handleGeneralSettings);
            
            // Company settings form
            document.getElementById('companySettingsForm').addEventListener('submit', handleCompanySettings);
            
            // Attendance settings form
            document.getElementById('attendanceSettingsForm').addEventListener('submit', handleAttendanceSettings);
            
            // Notification settings form
            document.getElementById('notificationSettingsForm').addEventListener('submit', handleNotificationSettings);
            
            // Security settings form
            document.getElementById('securitySettingsForm').addEventListener('submit', handleSecuritySettings);
            
            // Backup settings form
            document.getElementById('backupSettingsForm').addEventListener('submit', handleBackupSettings);
        }

        function setupFileUpload() {
            const fileInput = document.getElementById('companyLogo');
            const uploadArea = document.querySelector('.file-upload-area');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileUpload(e.target.files[0]);
                }
            });
        }

        function handleFileUpload(file) {
            if (file.size > 2 * 1024 * 1024) { // 2MB limit
                showNotification('File size must be less than 2MB', 'error');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showNotification('Please upload an image file', 'error');
                return;
            }
            
            // Mock file upload - in real implementation, upload to server
            showNotification('Logo uploaded successfully!', 'success');
        }

        function loadCurrentSettings() {
            // Load existing settings from storage
            const settings = StorageUtils.getLocal('system_settings', {});
            
            // Populate forms with current values
            populateFormFields(settings);
        }

        function populateFormFields(settings) {
            // General settings
            if (settings.language) document.getElementById('systemLanguage').value = settings.language;
            if (settings.timezone) document.getElementById('timezone').value = settings.timezone;
            if (settings.date_format) document.getElementById('dateFormat').value = settings.date_format;
            if (settings.time_format) document.getElementById('timeFormat').value = settings.time_format;
            if (settings.theme) document.getElementById('theme').value = settings.theme;
            
            // Company settings
            if (settings.company_name) document.getElementById('companyName').value = settings.company_name;
            if (settings.website) document.getElementById('companyWebsite').value = settings.website;
            if (settings.email) document.getElementById('companyEmail').value = settings.email;
            if (settings.phone) document.getElementById('companyPhone').value = settings.phone;
            if (settings.address) document.getElementById('companyAddress').value = settings.address;
            
            // Work hours
            if (settings.work_hours) {
                document.getElementById('workStartTime').value = settings.work_hours.start_time || '09:00';
                document.getElementById('workEndTime').value = settings.work_hours.end_time || '17:00';
                document.getElementById('breakDuration').value = settings.work_hours.break_duration || 60;
            }
            
            // Continue populating other settings...
        }

        function handleGeneralSettings(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const settings = {
                language: formData.get('language'),
                timezone: formData.get('timezone'),
                date_format: formData.get('date_format'),
                time_format: formData.get('time_format'),
                theme: formData.get('theme')
            };
            
            saveSettings('general', settings);
            showNotification('General settings saved successfully!', 'success');
        }

        function handleCompanySettings(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const settings = {
                company_name: formData.get('company_name'),
                website: formData.get('website'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                address: formData.get('address')
            };
            
            saveSettings('company', settings);
            showNotification('Company settings saved successfully!', 'success');
        }

        function handleAttendanceSettings(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const workDays = formData.getAll('work_days');
            
            const settings = {
                work_hours: {
                    start_time: formData.get('start_time'),
                    end_time: formData.get('end_time'),
                    break_duration: parseInt(formData.get('break_duration'))
                },
                attendance: {
                    late_threshold: parseInt(formData.get('late_threshold')),
                    early_checkout: parseInt(formData.get('early_checkout'))
                },
                work_days: workDays
            };
            
            saveSettings('attendance', settings);
            showNotification('Attendance settings saved successfully!', 'success');
        }

        function handleNotificationSettings(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const settings = {
                email_enabled: formData.get('email_enabled') === 'on',
                daily_summary: formData.get('daily_summary') === 'on',
                absence_alerts: formData.get('absence_alerts') === 'on',
                task_reminders: formData.get('task_reminders') === 'on',
                push_enabled: formData.get('push_enabled') === 'on',
                shift_reminders: formData.get('shift_reminders') === 'on',
                break_reminders: formData.get('break_reminders') === 'on',
                system_maintenance: formData.get('system_maintenance') === 'on',
                notification_email: formData.get('notification_email')
            };
            
            saveSettings('notifications', settings);
            showNotification('Notification settings saved successfully!', 'success');
        }

        function handleSecuritySettings(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const settings = {
                password_policy: {
                    min_length: parseInt(formData.get('min_password_length')),
                    expiry_days: parseInt(formData.get('password_expiry')),
                    require_uppercase: formData.get('require_uppercase') === 'on',
                    require_lowercase: formData.get('require_lowercase') === 'on',
                    require_numbers: formData.get('require_numbers') === 'on',
                    require_symbols: formData.get('require_symbols') === 'on'
                },
                session: {
                    timeout_minutes: parseInt(formData.get('session_timeout')),
                    max_login_attempts: parseInt(formData.get('max_login_attempts'))
                },
                privacy: {
                    audit_logging: formData.get('audit_logging') === 'on',
                    gdpr_compliance: formData.get('gdpr_compliance') === 'on',
                    ip_restrictions: formData.get('ip_restrictions') === 'on'
                }
            };
            
            saveSettings('security', settings);
            showNotification('Security settings saved successfully!', 'success');
        }

        function handleBackupSettings(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const settings = {
                auto_backup: formData.get('auto_backup') === 'on',
                backup_frequency: formData.get('backup_frequency'),
                backup_time: formData.get('backup_time'),
                retention_days: parseInt(formData.get('retention_days'))
            };
            
            saveSettings('backup', settings);
            showNotification('Backup settings saved successfully!', 'success');
        }

        function saveSettings(category, settings) {
            const allSettings = StorageUtils.getLocal('system_settings', {});
            allSettings[category] = settings;
            StorageUtils.setLocal('system_settings', allSettings);
        }

        // Tab navigation
        function showSettingsTab(tabName) {
            // Hide all panels
            document.querySelectorAll('.settings-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected panel
            document.getElementById(tabName + 'Settings').classList.add('active');
            
            // Add active class to selected tab
            event.target.classList.add('active');
        }

        // Utility functions
        function testNotifications() {
            showNotification('This is a test notification!', 'info');
        }

        function performManualBackup() {
            if (window.adminManager) {
                window.adminManager.performSystemBackup();
            } else {
                UIUtils.showLoading('Creating backup...');
                setTimeout(() => {
                    UIUtils.hideLoading();
                    showNotification('Manual backup completed successfully!', 'success');
                }, 2000);
            }
        }

        function downloadBackup() {
            // Mock backup download
            const backupData = {
                timestamp: new Date().toISOString(),
                version: '1.0.0',
                data: 'Mock backup data'
            };
            
            const filename = `backup_${DateTimeUtils.formatDate(new Date(), 'YYYY-MM-DD-HH-mm')}.json`;
            downloadFile(JSON.stringify(backupData, null, 2), filename, 'application/json');
            showNotification('Backup downloaded successfully!', 'success');
        }

        // Navigation functions
        function showEmployeeManagement() {
            window.location.href = 'admin-dashboard.html#employees';
        }

        function showTaskManagement() {
            showNotification('Task management feature coming soon!', 'info');
        }

        function showReports() {
            showNotification('Reports feature coming soon!', 'info');
        }

        function showProfile() {
            showNotification('Profile feature coming soon!', 'info');
        }

        function toggleNotifications() {
            showNotification('Notifications feature coming soon!', 'info');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userMenuDropdown');
            dropdown.classList.toggle('active');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userMenuDropdown').classList.remove('active');
            }
        });
    </script>
</body>
</html>
